import ports
import vga

#saved = None
#
#def savetext():
#	global saved
#	saved = vga.textbuffer[:4000]
#
#def restoretext():
#	vga.textbuffer[:4000] = saved

def set640x480x16():
	vga.savetext()

	ports.inb(0x3DA)
	ports.outb(0, 0x3C0)

	ports.writevec(0x3C4,0x3C5,  1,1,4,0,6)

	ports.outb(0xe3, 0x3C2)
	ports.writevec(0x3C4,0x3C5,  3)

	ports.outb(0x11, 0x3D4)
	ports.outb(   0, 0x3D5)

	ports.writevec(0x3D4,0x3D5,
                0x5f, 0x4f, 0x50, 0x82,  0x54, 0x80, 0x0b, 0x3e,
                0x00, 0x40, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
                0xea, 0x8c, 0xdf, 0x28,  0x00, 0xe7, 0x04, 0xe3,
                0xff)

	ports.writevec(0x3CC,0x3CA,  1)
        ports.writevec(0x3CE,0x3CF,
                0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x05, 0x0f,
                0xff)

	ports.inb(0x3DA)

	ports.writevec(0x3C0,0x3C0,
                0x00, 0x01, 0x02, 0x03,  0x04, 0x05, 0x06, 0x07,
                0x08, 0x09, 0x0A, 0x0B,  0x0C, 0x0D, 0x0E, 0x0F,
                0x01, 0x00, 0x0F, 0x00)

	ports.outb(0x20, 0x3C0)

def set80x25():
	ports.inb(0x3DA)
	ports.outb(0, 0x3C0)

	ports.writevec(0x3C4,0x3C5,  1,0,3,0,2)

	ports.outb(0x67, 0x3C2)
	ports.writevec(0x3C4,0x3C5,  3)

	ports.outb(0x11, 0x3D4)
	ports.outb(   0, 0x3D5)
	ports.writevec(0x3D4,0x3D5,
		0x5f, 0x4f, 0x50, 0x82,  0x55, 0x81, 0xbf, 0x1f,
		0x00, 0x4f, 0x0d, 0x0e,  0x00, 0x00, 0x00, 0x00,
		0x9c, 0x8e, 0x8f, 0x28,  0x1f, 0x96, 0xb9, 0xa3,
		0xff)

	ports.writevec(0x3CC,0x3CA,  1)
        ports.writevec(0x3CE,0x3CF,
		0x00, 0x00, 0x00, 0x00,  0x00, 0x10, 0x0e, 0x00,
		0xff)

	ports.inb(0x3DA)
	ports.writevec(0x3C0,0x3C0,
		0x00, 0x01, 0x02, 0x03,  0x04, 0x05, 0x06, 0x07,
		0x08, 0x09, 0x0A, 0x0B,  0x0C, 0x0D, 0x0E, 0x0F,
		0x0C, 0x00, 0x0F, 0x08)

	ports.outb(0x20, 0x3C0)
	vga.restoretext()


def set320x200x256():
	vga.savetext()

	ports.inb(0x3DA)
	ports.outb(0, 0x3C0)

	ports.writevec(0x3C4,0x3C5,  3,1,0xf,0,0xe)
	
	ports.outb(0x63, 0x3C2)
	ports.writevec(0x3C4,0x3C5,  3)

	ports.outb(0x11, 0x3D4)
	ports.outb(   0, 0x3D5)
	ports.writevec(0x3D4,0x3D5,
		0x5f, 0x4f, 0x50, 0x82,  0x54, 0x80, 0xbf, 0x1f,
		0x00, 0x41, 0x00, 0x00,  0x00, 0x00, 0x00, 0x00,
		0x9c, 0x0e, 0x8f, 0x28,  0x40, 0x96, 0xb9, 0xa3,
					# 0x00, ..., 0xe3 for mode X
		0xff)

	ports.writevec(0x3CC,0x3CA,  1)
        ports.writevec(0x3CE,0x3CF,
		0x00, 0x00, 0x00, 0x00,  0x00, 0x40, 0x05, 0x0f,
		0xff)

	ports.inb(0x3DA)
	ports.writevec(0x3C0,0x3C0,
		0x00, 0x01, 0x02, 0x03,  0x04, 0x05, 0x06, 0x07,
		0x08, 0x09, 0x0A, 0x0B,  0x0C, 0x0D, 0x0E, 0x0F,
		0x41, 0x00, 0x0F, 0x00)

	ports.outb(0x20, 0x3C0)

